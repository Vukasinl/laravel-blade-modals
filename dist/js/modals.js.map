{"version":3,"file":"modals.js","sources":["../../js/Modal.js","../../js/index.js"],"sourcesContent":["export default class Modal {\n    id;\n    el;\n    form;\n    submitBtn;\n    isAsync;\n    isClosable;\n    opened;\n    shouldRemoveClasses;\n    url;\n    message;\n\n    constructor(id, options = null) {\n        this.id = id;\n        this.el = document.querySelector(`[data-modal=\"${id}\"]`);\n        this.form = document.querySelector(`#modal-form-${id}`);\n        this.submitBtn = document.querySelector(`#submit-modal-form-${id}`);\n        this.isAsync = options.isAsync ? true : false;\n        this.isClosable = options.isClosable ? true : false;\n        this.opened = false;\n        this.shouldRemoveClasses = true;\n        this.url = options.url ? options.url : '';\n        this.message = '';\n    }\n\n    setUrl(value) {\n        if (!value) {\n            return;\n        }\n        this.url = value;\n        this.el.querySelector('.modal__form').setAttribute('action', value);\n    }\n\n    setMessage(value) {\n        this.message = value;\n    }\n\n    open() {\n        if (!this.opened) {\n            document.querySelector('body').classList.add('modal-is-opened');\n            this.el.classList.add('overlay');\n            this.el.querySelector('.modal-default').classList.remove(\"modal--hidden\");\n            this.el.querySelector('.js-modal').classList.add(\"modal__pop--index\");\n            if (this.message) {\n                this.el.querySelector('.modal__form-text').innerHTML = this.message;\n            }\n            this.opened = true;\n            this.shouldRemoveClasses = false;\n\n            let openedEvent = new CustomEvent(this.id + '-opened', { detail: event });\n            window.dispatchEvent(openedEvent);\n        }\n    }\n\n    close() {\n        document.querySelector('body').classList.remove('modal-is-opened');\n        this.el.classList.remove('overlay');\n        this.el.querySelector('.modal-default').classList.add(\"modal--hidden\");\n        this.el.querySelector('.js-modal').classList.remove(\"modal__pop--index\");\n        this.opened = false;\n        this.message = '';\n\n        let closedEvent = new CustomEvent(this.id + '-closed');\n        window.dispatchEvent(closedEvent);\n    }\n\n    openListener = (event) => {\n        event.preventDefault();\n\n        this.setUrl(event.currentTarget.getAttribute(\"data-url\"));\n        this.setMessage(event.currentTarget.getAttribute(\"data-message\"));\n\n        this.open();\n    }\n\n    closeListener = (event) => {\n        this.close();\n    }\n     \n    escapeCloseListener = (event) => {\n        event = event || window.event;\n        var isEscape = false;\n        if (\"key\" in event) {\n            isEscape = (event.key === \"Escape\" || event.key === \"Esc\");\n        } else {\n            isEscape = (event.keyCode === 27);\n        }\n        if (isEscape) {\n            this.close();\n        }\n    }\n\n    clickAwayListener = (event) => {\n        if (this.opened && this.shouldRemoveClasses) {\n            this.close();\n        }\n\n        this.shouldRemoveClasses = true;\n    }\n\n    innerClickListener = (event) => {\n        this.shouldRemoveClasses = false;\n    }\n\n    submitListener = (event) => {\n        event.preventDefault();\n\n        let startSubmit = new CustomEvent(this.id + '-submit', { detail: event });\n        window.dispatchEvent(startSubmit);\n\n        let formData = new FormData(this.form);\n\n        axios.post(this.url, formData)\n            .then(response => {\n                this.close();\n\n                let successEvent = new CustomEvent(this.id + '-success', { detail: response.data });\n                window.dispatchEvent(successEvent);\n            }).catch(error => {\n                let failEvent = new CustomEvent(this.id + '-error', { detail: error.response.data });\n                window.dispatchEvent(failEvent);\n            }).finally(() => {\n                //\n            });\n    }\n     \n    registerListeners() {\n        // Register open events\n        if(document.querySelector('.js-open-' + this.id)) {\n            document.querySelectorAll('.js-open-' + this.id).forEach((el) => {\n                el.addEventListener('click', this.openListener);\n            })\n        }\n\n        if(this.isClosable) {\n            // Register close events\n            this.el.querySelectorAll('.js-close-modal').forEach((el) => {\n                el.addEventListener('click', this.closeListener);\n            });\n\n            // Register click away close events\n            document.querySelector('html').addEventListener('click', this.clickAwayListener);\n            this.el.querySelector('.modal-default').addEventListener('click', this.innerClickListener);\n\n            // Register close on escape events\n            document.addEventListener('keydown', this.escapeCloseListener);\n        }else{\n            this.el.querySelectorAll('.js-close-modal').forEach((el) => {\n                el.style.display = \"none\";\n            });\n        }\n\n        if(this.isAsync){\n            this.form.addEventListener('submit', this.submitListener);\n        }\n    };\n\n    removeListeners() {\n        if (document.querySelector('.js-open-' + this.id)) {\n            document.querySelectorAll('.js-open-' + this.id).forEach((el) => {\n                el.removeEventListener('click', this.openListener);\n            })\n        }\n\n        if (this.isClosable) {\n            this.el.querySelectorAll('.js-close-modal').forEach((element) => {\n                element.removeEventListener('click', this.closeListener);\n            });\n\n            document.querySelector('html').removeEventListener('click', this.clickAwayListener);\n            this.el.querySelector('.modal-default').removeEventListener('click', this.innerClickListener);\n\n            document.removeEventListener('keydown', this.escapeCloseListener);\n        }\n\n        if (this.isAsync) {\n            this.form.removeEventListener('submit', this.submitListener);\n        }\n    }\n}\n","import './polyfills/index';\r\nimport Modal from './Modal';\r\n\r\nimport '../css/modals.scss';\r\n\r\nwindow.modals = [];\r\n\r\ninitializeModals();\r\n\r\nfunction initializeModals() {\r\n    document.querySelectorAll('[data-modal]').forEach(function (el) {\r\n        let modal = new Modal(\r\n            el.getAttribute('data-modal'),\r\n            {\r\n                isAsync: el.getAttribute('data-async') ? true : false,\r\n                isClosable: el.getAttribute('data-closable') ? true : false,\r\n                url: el.getAttribute('data-url')\r\n            }\r\n        );\r\n\r\n        modal.registerListeners();\r\n\r\n        if (el.getAttribute('data-start-opened')) {\r\n            modal.open();\r\n        }\r\n\r\n        window.modals.push(modal);\r\n    });\r\n}\r\n\r\nfunction removeModalListeners() {\r\n    while (window.modals.length) {\r\n        let modal = window.modals.shift();\r\n        modal.removeListeners();\r\n    }\r\n}\r\n\r\n// Reinitialize modals on livewire reload\r\ndocument.addEventListener(\"livewire:load\", function (event) {\r\n    // setTimeout so that modals are not reinitalized on the first livewire load\r\n    setTimeout(() => {\r\n        window.livewire.hook('message.processed', (message, component) => {\r\n            removeModalListeners();\r\n            initializeModals();\r\n        });\r\n    }, 1000);\r\n});\r\n"],"names":["Modal","id","options","event","preventDefault","_this","setUrl","currentTarget","getAttribute","setMessage","open","close","window","key","keyCode","opened","shouldRemoveClasses","startSubmit","CustomEvent","detail","dispatchEvent","formData","FormData","form","axios","post","url","then","response","successEvent","data","catch","error","failEvent","finally","el","document","querySelector","submitBtn","isAsync","isClosable","message","value","setAttribute","this","classList","add","remove","innerHTML","openedEvent","closedEvent","querySelectorAll","forEach","addEventListener","_this2","openListener","closeListener","clickAwayListener","innerClickListener","escapeCloseListener","style","display","submitListener","removeEventListener","_this3","element","initializeModals","modal","registerListeners","modals","push","setTimeout","livewire","hook","component","length","shift","removeListeners","removeModalListeners"],"mappings":"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"}